function _0x5869(){const _0x4488a9=['cookies','20471187AzruRo','remove','query','session_paste_detected','crunchyroll.com','tabs','expiresAt','2230jPHWXw','message','secure','split','No\x20se\x20pudieron\x20restaurar\x20las\x20cookies','debug','expirationDate','779SGsMiq','onChanged','objectStoreNames','sessionId','put','session_expired','DateTimeFormat','session_id','invalidateSessionOnPaste','length','getCurrent','session_info','.crunchyroll.com','onsuccess','146290qDHiJF','cr_session_invalidated','catch','join','sessionExpiryTime','6jvoJVt','etp_rt','runtime','lastError','storage','onMessage','protected_cookies','get','now','padStart','El\x20token\x20de\x20sesión\x20no\x20es\x20válido\x20o\x20ha\x20expirado','session_paste','UNLIMITED_USERS_ACCESS','local','objectStore','subtle','url','forEach','some','reload','crunchyroll_protected_cookies','parse','resolvedOptions','2.0','endSession','1398610RUewun','timestamp','createIndex','random','name','then','crunchyroll_protection_enabled','112SGwIvV','includes','readonly','cookie','getAll','userAgent','create','removed','2092377lixIZu','readwrite','error','find','disable','toggleSessionPersistence','httpOnly','getSessionExpiry','token','etp_client_token','open','enabled','729ywuNGu','reduce','sessionToken','createObjectStore','201800wbJbGh','crunchyroll_session_info','domain','map','cr_session_id_heartbeat','onInstalled','onStartup','sessionExpired','Código\x20de\x20sesión\x20inválido:\x20','result','toggleFingerprintVerification','restorePermanentSession','SHA-256','startsWith','clear','active','onerror','accessKey','addListener','isValid','version','contains','CrunchyrollProtectionDB','action','set','Código\x20inválido\x20o\x20incompatible','digest','El\x20fingerprint\x20del\x20dispositivo\x20no\x20coincide\x20con\x20el\x20de\x20la\x20sesión\x20original','timeZone','toString','onupgradeneeded','oncomplete','sendMessage','setSessionToken','3460916JdlTRb','transaction','Este\x20código\x20no\x20es\x20para\x20Crunchyroll\x20Access\x20Freedom\x20versión\x202.0','https://www.crunchyroll.com'];_0x5869=function(){return _0x4488a9;};return _0x5869();}const _0x3185f6=_0x3e03;(function(_0x32f6fb,_0x32ce4a){const _0x3e5b24=_0x3e03,_0x4931c0=_0x32f6fb();while(!![]){try{const _0x4011a4=-parseInt(_0x3e5b24(0x14b))/0x1*(-parseInt(_0x3e5b24(0x144))/0x2)+-parseInt(_0x3e5b24(0x106))/0x3+-parseInt(_0x3e5b24(0x138))/0x4+-parseInt(_0x3e5b24(0xf7))/0x5*(-parseInt(_0x3e5b24(0xde))/0x6)+-parseInt(_0x3e5b24(0xfe))/0x7*(-parseInt(_0x3e5b24(0x116))/0x8)+-parseInt(_0x3e5b24(0x112))/0x9*(parseInt(_0x3e5b24(0xd9))/0xa)+parseInt(_0x3e5b24(0x13d))/0xb;if(_0x4011a4===_0x32ce4a)break;else _0x4931c0['push'](_0x4931c0['shift']());}catch(_0x5895ad){_0x4931c0['push'](_0x4931c0['shift']());}}}(_0x5869,0xa26c7));let sessionExpiryTime=null,currentSessionInfo={'sessionId':null,'originalCode':null,'isValid':!![],'createdAt':null,'deviceFingerprint':null,'sessionToken':null,'browserId':null},heartbeatInterval=null,monitoringInterval=null,verifyFingerprint=![];const browserInstanceId=_0x3185f6(0xea);let originalCookies=null,cookieMonitoringInterval=null,isSessionClosing=![],sessionPersistenceEnabled=!![],protectedCookies=null,isRestoringCookies=![];const PROTECTED_COOKIES_KEY=_0x3185f6(0xf2),SESSION_INFO_KEY=_0x3185f6(0x117),PROTECTION_ENABLED_KEY=_0x3185f6(0xfd),IDB_NAME=_0x3185f6(0x12c),IDB_VERSION=0x1,IDB_STORE_COOKIES=_0x3185f6(0xe4),IDB_STORE_SESSION=_0x3185f6(0xd6);let db=null;const ACCESS_FREEDOM_VERSION=_0x3185f6(0xf5);async function initIndexedDB(){return new Promise((_0x209425,_0x275a6b)=>{const _0x13a488=_0x3e03,_0x5daeeb=indexedDB[_0x13a488(0x110)](IDB_NAME,IDB_VERSION);_0x5daeeb[_0x13a488(0x126)]=()=>{_0x275a6b(_0x5daeeb['error']);},_0x5daeeb[_0x13a488(0xd8)]=()=>{const _0x4097b2=_0x13a488;db=_0x5daeeb[_0x4097b2(0x11f)],_0x209425(db);},_0x5daeeb[_0x13a488(0x134)]=_0xb76fa7=>{const _0x32bb47=_0x13a488,_0x206315=_0xb76fa7['target'][_0x32bb47(0x11f)];if(!_0x206315[_0x32bb47(0x14d)][_0x32bb47(0x12b)](IDB_STORE_COOKIES)){const _0x40447e=_0x206315[_0x32bb47(0x115)](IDB_STORE_COOKIES,{'keyPath':_0x32bb47(0xfb)});_0x40447e['createIndex'](_0x32bb47(0xf8),_0x32bb47(0xf8),{'unique':![]});}if(!_0x206315[_0x32bb47(0x14d)][_0x32bb47(0x12b)](IDB_STORE_SESSION)){const _0x654239=_0x206315['createObjectStore'](IDB_STORE_SESSION,{'keyPath':_0x32bb47(0x14e)});_0x654239[_0x32bb47(0xf9)](_0x32bb47(0xf8),_0x32bb47(0xf8),{'unique':![]});}};});}async function saveCookiesToIndexedDB(_0x443533){if(!db)await initIndexedDB();return new Promise((_0x398141,_0xe9215f)=>{const _0x1b85df=_0x3e03,_0x234357=db[_0x1b85df(0x139)]([IDB_STORE_COOKIES],_0x1b85df(0x107)),_0x1a6bf6=_0x234357[_0x1b85df(0xec)](IDB_STORE_COOKIES),_0x307227=_0x1a6bf6[_0x1b85df(0x124)]();_0x307227[_0x1b85df(0xd8)]=()=>{const _0x7c2b1a=_0x1b85df;_0x443533['forEach'](_0x5d6407=>{const _0x470088=_0x3e03;_0x5d6407[_0x470088(0xf8)]=Date[_0x470088(0xe6)](),_0x1a6bf6[_0x470088(0x14f)](_0x5d6407);}),_0x234357[_0x7c2b1a(0x135)]=()=>{_0x398141(!![]);},_0x234357[_0x7c2b1a(0x126)]=()=>{const _0x11a235=_0x7c2b1a;_0xe9215f(_0x234357[_0x11a235(0x108)]);};};});}async function loadCookiesFromIndexedDB(){if(!db)await initIndexedDB();return new Promise((_0x278d51,_0xfa4a91)=>{const _0x28fc87=_0x3e03,_0x540d17=db[_0x28fc87(0x139)]([IDB_STORE_COOKIES],_0x28fc87(0x100)),_0x185f8a=_0x540d17[_0x28fc87(0xec)](IDB_STORE_COOKIES),_0x4bcdb7=_0x185f8a['getAll']();_0x4bcdb7['onsuccess']=()=>{const _0x5e523e=_0x28fc87,_0x4e5e1b=_0x4bcdb7[_0x5e523e(0x11f)];_0x278d51(_0x4e5e1b);},_0x4bcdb7['onerror']=()=>{const _0x417b8a=_0x28fc87;_0xfa4a91(_0x540d17[_0x417b8a(0x108)]);};});}async function saveSessionToIndexedDB(_0x355fcf){if(!db)await initIndexedDB();return new Promise((_0x34dfc4,_0x21c081)=>{const _0x2b31c4=_0x3e03,_0x2d43db=db[_0x2b31c4(0x139)]([IDB_STORE_SESSION],_0x2b31c4(0x107)),_0x183998=_0x2d43db[_0x2b31c4(0xec)](IDB_STORE_SESSION);_0x355fcf[_0x2b31c4(0xf8)]=Date['now']();const _0xaf42e6=_0x183998[_0x2b31c4(0x14f)](_0x355fcf);_0xaf42e6[_0x2b31c4(0xd8)]=()=>{_0x34dfc4(!![]);},_0xaf42e6[_0x2b31c4(0x126)]=()=>{const _0x1f471a=_0x2b31c4;_0x21c081(_0x2d43db[_0x1f471a(0x108)]);};});}async function loadSessionFromIndexedDB(){if(!db)await initIndexedDB();return new Promise((_0x27afb7,_0x47f298)=>{const _0x3f461f=_0x3e03,_0x43b546=db['transaction']([IDB_STORE_SESSION],_0x3f461f(0x100)),_0x3d19ef=_0x43b546['objectStore'](IDB_STORE_SESSION),_0x4f7213=_0x3d19ef[_0x3f461f(0x102)]();_0x4f7213['onsuccess']=()=>{const _0x2cd9d9=_0x3f461f,_0x11f6fe=_0x4f7213[_0x2cd9d9(0x11f)];if(_0x11f6fe&&_0x11f6fe[_0x2cd9d9(0xd4)]>0x0){const _0x106f4f=_0x11f6fe[_0x2cd9d9(0x113)]((_0xc98453,_0x4c1799)=>_0x4c1799[_0x2cd9d9(0xf8)]>_0xc98453[_0x2cd9d9(0xf8)]?_0x4c1799:_0xc98453);_0x27afb7(_0x106f4f);}else _0x27afb7(null);},_0x4f7213[_0x3f461f(0x126)]=()=>{_0x47f298(_0x43b546['error']);};});}function generateBrowserInstanceId(){const _0xc90f89=_0x3185f6;return _0xc90f89(0xea);}function saveSessionExpiry(_0x268347){const _0x51cd57=_0x3185f6;sessionExpiryTime=_0x268347,chrome[_0x51cd57(0xe2)][_0x51cd57(0xeb)][_0x51cd57(0x12e)]({'sessionExpiryTime':_0x268347});}function loadSessionExpiry(){return new Promise(_0x599156=>{const _0x362975=_0x3e03;chrome[_0x362975(0xe2)][_0x362975(0xeb)][_0x362975(0xe5)]([_0x362975(0xdd)],_0x2cad0b=>{const _0x293ca8=_0x362975;sessionExpiryTime=_0x2cad0b[_0x293ca8(0xdd)]||null,_0x599156(sessionExpiryTime);});});}async function saveProtectedCookiesToStorage(_0x187afa){const _0x3f69e1=_0x3185f6;try{const _0x55d5be=_0x187afa[_0x3f69e1(0x119)](_0x28e50e=>({'name':_0x28e50e[_0x3f69e1(0xfb)],'value':_0x28e50e['value'],'domain':_0x28e50e[_0x3f69e1(0x118)]||_0x3f69e1(0xd7),'path':_0x28e50e['path']||'/','secure':_0x28e50e[_0x3f69e1(0x146)]!==![],'httpOnly':_0x28e50e[_0x3f69e1(0x10c)]!==![],'expirationDate':_0x28e50e[_0x3f69e1(0x14a)]||Date[_0x3f69e1(0xe6)]()/0x3e8+0x3f480}));await chrome[_0x3f69e1(0xe2)]['local'][_0x3f69e1(0x12e)]({[PROTECTED_COOKIES_KEY]:_0x55d5be,[PROTECTION_ENABLED_KEY]:!![]}),await saveCookiesToIndexedDB(_0x55d5be);}catch(_0x2bd6e4){}}async function loadProtectedCookiesFromStorage(){const _0x5c284e=_0x3185f6;try{const _0x49fc06=await chrome['storage'][_0x5c284e(0xeb)][_0x5c284e(0xe5)]([PROTECTED_COOKIES_KEY,PROTECTION_ENABLED_KEY]);if(_0x49fc06[PROTECTION_ENABLED_KEY]&&_0x49fc06[PROTECTED_COOKIES_KEY])return protectedCookies=_0x49fc06[PROTECTED_COOKIES_KEY],!![];const _0x73d779=await loadCookiesFromIndexedDB();if(_0x73d779&&_0x73d779['length']>0x0)return protectedCookies=_0x73d779,await chrome[_0x5c284e(0xe2)][_0x5c284e(0xeb)][_0x5c284e(0x12e)]({[PROTECTED_COOKIES_KEY]:_0x73d779,[PROTECTION_ENABLED_KEY]:!![]}),!![];return![];}catch(_0xe1f48){return![];}}async function saveSessionInfoToStorage(){const _0x4bcfc5=_0x3185f6;try{await chrome[_0x4bcfc5(0xe2)][_0x4bcfc5(0xeb)]['set']({[SESSION_INFO_KEY]:currentSessionInfo}),await saveSessionToIndexedDB(currentSessionInfo);}catch(_0x54e9bb){}}async function loadSessionInfoFromStorage(){const _0x546490=_0x3185f6;try{const _0x27bcc8=await chrome['storage'][_0x546490(0xeb)][_0x546490(0xe5)]([SESSION_INFO_KEY]);if(_0x27bcc8[SESSION_INFO_KEY])return currentSessionInfo=_0x27bcc8[SESSION_INFO_KEY],!![];const _0x3583dd=await loadSessionFromIndexedDB();if(_0x3583dd)return currentSessionInfo=_0x3583dd,await chrome['storage'][_0x546490(0xeb)]['set']({[SESSION_INFO_KEY]:_0x3583dd}),!![];return![];}catch(_0x3f4992){return![];}}loadSessionExpiry();async function initializePersistentData(){const _0x17466e=_0x3185f6;try{await initIndexedDB();const _0x38743b=await loadProtectedCookiesFromStorage(),_0x259042=await loadSessionInfoFromStorage();currentSessionInfo['sessionId']&&(startCookieMonitoring(),startSecurityMonitoring(),currentSessionInfo[_0x17466e(0x14e)]&&startHeartbeat(currentSessionInfo['sessionId']));}catch(_0x59399c){}}initializePersistentData();async function generateDeviceFingerprint(){const _0x6ffec6=_0x3185f6;try{const _0x19052f=['crunchyroll_session_unlimited',navigator[_0x6ffec6(0x103)],Intl[_0x6ffec6(0x151)]()[_0x6ffec6(0xf4)]()[_0x6ffec6(0x132)],navigator['language']],_0x545b9d=_0x19052f[_0x6ffec6(0xdc)]('|'),_0x469b61=new TextEncoder(),_0x10e1d5=_0x469b61['encode'](_0x545b9d),_0x5eb049=await crypto[_0x6ffec6(0xed)][_0x6ffec6(0x130)](_0x6ffec6(0x122),_0x10e1d5),_0x1a4fbe=Array['from'](new Uint8Array(_0x5eb049));return _0x1a4fbe['map'](_0x540677=>_0x540677[_0x6ffec6(0x133)](0x10)[_0x6ffec6(0xe7)](0x2,'0'))[_0x6ffec6(0xdc)]('');}catch(_0x2caf65){return'crunchyroll_unlimited_fingerprint_123456789';}}function isSessionPasteCode(_0x19e826){const _0x32dc11=_0x3185f6;return _0x19e826[_0x32dc11(0x123)](_0x32dc11(0xe9));}async function getCrunchyrollCookies(){const _0x4a92fd=_0x3185f6;try{return await chrome[_0x4a92fd(0x13c)]['getAll']({'domain':'.crunchyroll.com'});}catch(_0x412c44){return[];}}function compareCookies(_0x1b3311,_0x53a969){return![];}async function restoreProtectedCookies(){const _0x403875=_0x3185f6;if(!protectedCookies||isRestoringCookies)return;isRestoringCookies=!![];try{const _0x59967d=['session_id',_0x403875(0xdf),_0x403875(0x10f)],_0x551aca=await getCrunchyrollCookies();let _0xd4b86f=![];for(const _0x291f85 of _0x59967d){const _0x4c1fbf=protectedCookies[_0x403875(0x109)](_0x187d41=>_0x187d41[_0x403875(0xfb)]===_0x291f85),_0x219999=_0x551aca[_0x403875(0x109)](_0x590964=>_0x590964[_0x403875(0xfb)]===_0x291f85);if(!_0x219999||_0x4c1fbf&&_0x4c1fbf['value']!==_0x219999['value']){_0xd4b86f=!![];break;}}if(_0xd4b86f)for(const _0x32f7ef of _0x59967d){const _0x525570=protectedCookies[_0x403875(0x109)](_0x4299c9=>_0x4299c9[_0x403875(0xfb)]===_0x32f7ef);if(_0x525570)try{await chrome[_0x403875(0x13c)][_0x403875(0x12e)]({'url':_0x403875(0x13b),'name':_0x525570[_0x403875(0xfb)],'value':_0x525570['value'],'domain':_0x525570[_0x403875(0x118)]||_0x403875(0xd7),'path':_0x525570['path']||'/','secure':_0x525570[_0x403875(0x146)]!==![],'httpOnly':_0x525570['httpOnly']!==![],'expirationDate':_0x525570[_0x403875(0x14a)]||Date['now']()/0x3e8+0x3f480});}catch(_0x40a494){}}}catch(_0x45c4ad){}finally{isRestoringCookies=![];}}function startCookieMonitoring(){cookieMonitoringInterval&&clearInterval(cookieMonitoringInterval),cookieMonitoringInterval=setInterval(async()=>{const _0x121ee7=_0x3e03;try{if(!currentSessionInfo['sessionId']||!currentSessionInfo[_0x121ee7(0x129)]||isSessionClosing||isRestoringCookies)return;const _0x1dc008=await getCrunchyrollCookies();if(!originalCookies){originalCookies=_0x1dc008,protectedCookies=[..._0x1dc008],await saveProtectedCookiesToStorage(protectedCookies);return;}const _0x127c5f=[_0x121ee7(0x152),_0x121ee7(0xdf),'etp_client_token'],_0x52c7af=_0x127c5f[_0x121ee7(0xf0)](_0x134eda=>_0x1dc008[_0x121ee7(0xf0)](_0x319db1=>_0x319db1['name']===_0x134eda));!_0x52c7af&&await restoreProtectedCookies();}catch(_0x22a142){}},0x493e0);}function stopCookieMonitoring(){cookieMonitoringInterval&&(clearInterval(cookieMonitoringInterval),cookieMonitoringInterval=null),originalCookies=null;}function startHeartbeat(_0xd0a333){heartbeatInterval&&clearInterval(heartbeatInterval),heartbeatInterval=setInterval(async()=>{const _0x25d360=_0x3e03;try{if(!currentSessionInfo['sessionId']||!currentSessionInfo['isValid']||isSessionClosing){clearInterval(heartbeatInterval),heartbeatInterval=null;return;}await chrome['storage'][_0x25d360(0xeb)][_0x25d360(0x12e)]({['heartbeat_'+_0xd0a333]:Date[_0x25d360(0xe6)]()});try{await chrome[_0x25d360(0x13c)][_0x25d360(0x12e)]({'url':'https://www.crunchyroll.com','name':'cr_session_id_heartbeat','value':'UNLIMITED_ACCESS','domain':_0x25d360(0xd7),'secure':!![],'httpOnly':![],'expirationDate':Date['now']()/0x3e8+0x708});}catch(_0x5a068a){}const _0x3ebb0a=await chrome[_0x25d360(0xe2)][_0x25d360(0xeb)][_0x25d360(0xe5)]([_0xd0a333]);(!_0x3ebb0a[_0xd0a333]||!_0x3ebb0a[_0xd0a333][_0x25d360(0x125)])&&(clearInterval(heartbeatInterval),heartbeatInterval=null);}catch(_0x2603bb){}},0xdbba0);}function stopHeartbeat(){const _0x492cc1=_0x3185f6;heartbeatInterval&&(clearInterval(heartbeatInterval),heartbeatInterval=null);try{chrome[_0x492cc1(0x13c)][_0x492cc1(0x13e)]({'url':_0x492cc1(0x13b),'name':_0x492cc1(0x11a)});}catch(_0x49ab5a){}}function startSecurityMonitoring(){monitoringInterval&&clearInterval(monitoringInterval),monitoringInterval=setInterval(async()=>{const _0x597075=_0x3e03;try{if(!currentSessionInfo[_0x597075(0x14e)]||!currentSessionInfo[_0x597075(0x129)]||isSessionClosing)return;Math[_0x597075(0xfa)]()<0.3&&await restoreProtectedCookies();if(sessionExpiryTime&&Date['now']()>sessionExpiryTime){await invalidateSession(_0x597075(0x150));return;}}catch(_0x205190){}},0x927c0);}function stopSecurityMonitoring(){monitoringInterval&&(clearInterval(monitoringInterval),monitoringInterval=null);}async function invalidateSession(_0x150bc9){const _0x508437=_0x3185f6;if(_0x150bc9!==_0x508437(0x150))return![];if(currentSessionInfo['sessionId']&&currentSessionInfo[_0x508437(0x129)]&&!isSessionClosing)return isSessionClosing=!![],currentSessionInfo['isValid']=![],await saveSessionInfoToStorage(),await endSessionCompletely(),!![];return![];}function logSecurityEvent(_0x4a8517,_0x17302a={}){const _0x53b9d6=_0x3185f6;chrome[_0x53b9d6(0xe2)][_0x53b9d6(0xeb)]['get'](['securityLog'],_0x2aec2f=>{const _0x3f485d=_0x53b9d6,_0x1a79c2=_0x2aec2f['securityLog']||[];_0x1a79c2['unshift']({'timestamp':Date[_0x3f485d(0xe6)](),'event':_0x4a8517,'details':_0x17302a}),_0x1a79c2[_0x3f485d(0xd4)]>0x64&&_0x1a79c2['pop'](),chrome[_0x3f485d(0xe2)]['local'][_0x3f485d(0x12e)]({'securityLog':_0x1a79c2});});}async function invalidateSessionOnPasteAttempt(){const _0x248223=_0x3185f6;return await invalidateSession(_0x248223(0x140));}async function restoreCookies(_0x389b2e){const _0x2f99f5=_0x3185f6;try{const _0x1521c0=JSON[_0x2f99f5(0xf3)](atob(_0x389b2e));if(Date['now']()>_0x1521c0[_0x2f99f5(0x143)])throw new Error('La\x20sesión\x20ha\x20expirado');const _0x10cb00=await generateDeviceFingerprint();if(verifyFingerprint&&_0x10cb00!==_0x1521c0['deviceFingerprint'])throw new Error(_0x2f99f5(0x131));if(_0x1521c0[_0x2f99f5(0x114)]){const _0x1bf06d=await validateSessionToken(_0x1521c0['sessionToken']);if(!_0x1bf06d)throw new Error(_0x2f99f5(0xe8));}saveSessionExpiry(_0x1521c0['expiresAt']);const _0x1bc9e1=_0x1521c0[_0x2f99f5(0x13c)]['split'](';\x20');let _0x4bb07a=0x0;const _0x21b968=[_0x2f99f5(0x152),_0x2f99f5(0xdf),_0x2f99f5(0x10f)],_0x453d82=await getCrunchyrollCookies();for(const _0x3b0d51 of _0x21b968){try{await chrome['cookies']['remove']({'url':_0x2f99f5(0x13b),'name':_0x3b0d51});}catch(_0xbe86dc){}}for(const _0x4851ab of _0x1bc9e1){const [_0x36ce4c,_0x30f9d2]=_0x4851ab[_0x2f99f5(0x147)]('=');if(_0x21b968['includes'](_0x36ce4c))try{await chrome[_0x2f99f5(0x13c)][_0x2f99f5(0x12e)]({'url':'https://www.crunchyroll.com','name':_0x36ce4c,'value':_0x30f9d2,'domain':'.crunchyroll.com','secure':!![],'httpOnly':!![],'expirationDate':Date[_0x2f99f5(0xe6)]()/0x3e8+0x3f480}),_0x4bb07a++;}catch(_0x4bbb7d){}}for(const _0x5efbb7 of _0x1bc9e1){const [_0x405116,_0x2906e1]=_0x5efbb7['split']('=');if(!_0x21b968[_0x2f99f5(0xff)](_0x405116))try{await chrome[_0x2f99f5(0x13c)][_0x2f99f5(0x12e)]({'url':_0x2f99f5(0x13b),'name':_0x405116,'value':_0x2906e1,'domain':_0x2f99f5(0xd7),'secure':!![],'httpOnly':!![],'expirationDate':Date['now']()/0x3e8+0x3f480}),_0x4bb07a++;}catch(_0x3a2f0f){}}const _0xdc45ce=await getCrunchyrollCookies();return protectedCookies=[..._0xdc45ce],await saveProtectedCookiesToStorage(protectedCookies),_0x4bb07a>0x0;}catch(_0x1cb21d){throw new Error(_0x2f99f5(0x11e)+_0x1cb21d[_0x2f99f5(0x145)]);}}async function validateSessionToken(_0x2de2f1){try{return _0x2de2f1&&_0x2de2f1['length']>0x0;}catch(_0x4170e0){return![];}}async function restorePermanentSession(_0x294ed5,_0x352dcf,_0x15f042){const _0x2b3514=_0x3185f6;try{if(isSessionPasteCode(_0x15f042)){await invalidateSessionOnPasteAttempt();throw new Error('No\x20se\x20permiten\x20códigos\x20de\x20session_paste.\x20La\x20sesión\x20actual\x20ha\x20sido\x20invalidada.');}let _0x37d991;try{_0x37d991=JSON[_0x2b3514(0xf3)](atob(_0x15f042));}catch(_0x249bf6){throw new Error(_0x2b3514(0x12f));}if(_0x37d991[_0x2b3514(0x12a)]!==ACCESS_FREEDOM_VERSION)throw new Error('Este\x20código\x20no\x20es\x20para\x20Crunchyroll\x20Access\x20Freedom\x20versión\x202.0');const _0x55e43d=await restoreCookies(_0x15f042);if(!_0x55e43d)throw new Error(_0x2b3514(0x148));currentSessionInfo={'sessionId':_0x294ed5,'originalCode':_0x15f042,'isValid':!![],'createdAt':Date['now'](),'deviceFingerprint':_0x37d991['deviceFingerprint'],'sessionToken':_0x37d991[_0x2b3514(0x114)],'browserId':browserInstanceId},await chrome[_0x2b3514(0xe2)][_0x2b3514(0xeb)][_0x2b3514(0x12e)]({['session_'+_0x294ed5]:currentSessionInfo}),await saveSessionInfoToStorage(),isSessionClosing=![],originalCookies=await getCrunchyrollCookies(),startHeartbeat(_0x294ed5),startSecurityMonitoring(),startCookieMonitoring();const _0x1cad89=await chrome['windows'][_0x2b3514(0xd5)](),_0x3bb5c2=await chrome['tabs'][_0x2b3514(0x13f)]({'windowId':_0x1cad89['id']}),_0x2be793=_0x3bb5c2['filter'](_0x5df64f=>_0x5df64f['url']&&_0x5df64f[_0x2b3514(0xee)][_0x2b3514(0xff)]('crunchyroll.com'));return _0x2be793[_0x2b3514(0xd4)]>0x0?_0x2be793[_0x2b3514(0xef)]((_0x3446fe,_0x4c560a)=>{setTimeout(()=>{const _0x1466db=_0x3e03;chrome[_0x1466db(0x142)][_0x1466db(0xf1)](_0x3446fe['id']);},0x3e8+_0x4c560a*0x1f4);}):setTimeout(()=>{const _0x5f006f=_0x2b3514;chrome[_0x5f006f(0x142)][_0x5f006f(0x104)]({'url':_0x5f006f(0x13b),'windowId':_0x1cad89['id'],'active':!![]});},0x5dc),!![];}catch(_0x55a6f5){if(_0x55a6f5[_0x2b3514(0x145)][_0x2b3514(0xff)](_0x2b3514(0x13a)))throw _0x55a6f5;throw new Error('Error\x20al\x20restaurar\x20la\x20sesión:\x20'+_0x55a6f5[_0x2b3514(0x145)]);}}function _0x3e03(_0x3e884f,_0x4745bc){const _0x5869bf=_0x5869();return _0x3e03=function(_0x3e0329,_0x59ed99){_0x3e0329=_0x3e0329-0xd3;let _0x73e5e6=_0x5869bf[_0x3e0329];return _0x73e5e6;},_0x3e03(_0x3e884f,_0x4745bc);}async function endSessionCompletely(){const _0x179e46=_0x3185f6;if(isSessionClosing)return![];try{stopHeartbeat(),stopSecurityMonitoring(),stopCookieMonitoring();try{await chrome[_0x179e46(0x13c)][_0x179e46(0x13e)]({'url':_0x179e46(0x13b),'name':_0x179e46(0xda)});}catch(_0x1ec13c){}return setTimeout(()=>{isSessionClosing=![];},0x1388),!![];}catch(_0x1d52b5){return![];}}setInterval(async()=>{const _0x620c52=_0x3185f6;if(sessionExpiryTime&&Date[_0x620c52(0xe6)]()>sessionExpiryTime&&!isSessionClosing){saveSessionExpiry(null),await endSessionCompletely();try{chrome[_0x620c52(0xe0)][_0x620c52(0x136)]({'action':_0x620c52(0x11d)});}catch(_0x58fa11){}}},0x493e0),chrome[_0x3185f6(0xe0)][_0x3185f6(0xe3)][_0x3185f6(0x128)]((_0x2acb54,_0x3b36ff,_0x103ecf)=>{const _0xb03cf=_0x3185f6;if(_0x2acb54['action']===_0xb03cf(0x121))return restorePermanentSession(_0x2acb54['sessionId'],_0x2acb54[_0xb03cf(0x127)],_0x2acb54['encryptedData'])[_0xb03cf(0xfc)](()=>{_0x103ecf({'success':!![]});})[_0xb03cf(0xdb)](_0x303d8c=>{const _0x1107ea=_0xb03cf;_0x103ecf({'success':![],'error':_0x303d8c[_0x1107ea(0x145)]});}),!![];if(_0x2acb54['action']===_0xb03cf(0x10d))return _0x103ecf({'expiryTime':sessionExpiryTime}),!![];if(_0x2acb54[_0xb03cf(0x12d)]===_0xb03cf(0xf6))return endSessionCompletely()['then'](()=>{_0x103ecf({'success':!![]});})[_0xb03cf(0xdb)](_0x1e2dcc=>{const _0x4bd0ba=_0xb03cf;_0x103ecf({'success':![],'error':_0x1e2dcc[_0x4bd0ba(0x145)]});}),!![];if(_0x2acb54['action']===_0xb03cf(0xd3))return invalidateSessionOnPasteAttempt()[_0xb03cf(0xfc)](_0x3fa2e5=>{_0x103ecf({'success':_0x3fa2e5});})[_0xb03cf(0xdb)](_0x3c2f3f=>{const _0x5ed422=_0xb03cf;_0x103ecf({'success':![],'error':_0x3c2f3f[_0x5ed422(0x145)]});}),!![];if(_0x2acb54[_0xb03cf(0x12d)]===_0xb03cf(0x137))return chrome[_0xb03cf(0xe2)][_0xb03cf(0xeb)][_0xb03cf(0x12e)]({'sessionToken':_0x2acb54[_0xb03cf(0x10e)]},()=>{_0x103ecf({'success':!![]});}),!![];if(_0x2acb54[_0xb03cf(0x12d)]==='showNotification')return _0x103ecf({'success':!![]}),!![];if(_0x2acb54[_0xb03cf(0x12d)]==='sessionPasteDetected')return invalidateSessionOnPasteAttempt()[_0xb03cf(0xfc)](_0x2c5783=>{_0x103ecf({'success':_0x2c5783});})[_0xb03cf(0xdb)](_0x431798=>{const _0x2abf4e=_0xb03cf;_0x103ecf({'success':![],'error':_0x431798[_0x2abf4e(0x145)]});}),!![];if(_0x2acb54[_0xb03cf(0x12d)]===_0xb03cf(0x120))return verifyFingerprint=_0x2acb54[_0xb03cf(0x111)],_0x103ecf({'success':!![]}),!![];if(_0x2acb54[_0xb03cf(0x12d)]===_0xb03cf(0x10b))return sessionPersistenceEnabled=_0x2acb54['enabled'],_0x103ecf({'success':!![]}),!![];if(_0x2acb54[_0xb03cf(0x145)]==='enable'||_0x2acb54[_0xb03cf(0x145)]===_0xb03cf(0x10a)||_0x2acb54[_0xb03cf(0x145)]===_0xb03cf(0x149))return chrome[_0xb03cf(0x142)][_0xb03cf(0x13f)]({'active':!![],'currentWindow':!![]},function(_0x30c6d5){const _0xf26b9f=_0xb03cf;_0x30c6d5[_0xf26b9f(0xd4)]>0x0&&chrome['tabs'][_0xf26b9f(0x136)](_0x30c6d5[0x0]['id'],{'message':_0x2acb54[_0xf26b9f(0x145)]},_0x1baf71=>{const _0x51ee2f=_0xf26b9f;if(chrome[_0x51ee2f(0xe0)][_0x51ee2f(0xe1)]){}});}),_0x103ecf({'success':!![]}),!![];}),chrome[_0x3185f6(0x13c)][_0x3185f6(0x14c)][_0x3185f6(0x128)](_0x5a3bab=>{const _0x29d619=_0x3185f6;if(_0x5a3bab[_0x29d619(0x101)][_0x29d619(0x118)][_0x29d619(0xff)](_0x29d619(0x141))&&currentSessionInfo[_0x29d619(0x14e)]&&!isRestoringCookies){const _0x53f60f=['session_id',_0x29d619(0xdf),'etp_client_token'];if(!_0x53f60f[_0x29d619(0xff)](_0x5a3bab['cookie'][_0x29d619(0xfb)]))return;_0x5a3bab[_0x29d619(0x105)]&&setTimeout(()=>{restoreProtectedCookies();},0xbb8);}}),chrome[_0x3185f6(0xe0)][_0x3185f6(0x11b)][_0x3185f6(0x128)](()=>{const _0x2e6183=_0x3185f6;chrome['storage'][_0x2e6183(0xeb)][_0x2e6183(0x12e)]({'sessionPersistenceEnabled':!![]}),initializePersistentData();}),chrome[_0x3185f6(0xe0)][_0x3185f6(0x11c)][_0x3185f6(0x128)](()=>{initializePersistentData();});