const _0x3fc2a2=_0x1e08;(function(_0x38220f,_0x17faab){const _0x11ad7=_0x1e08,_0x550cc7=_0x38220f();while(!![]){try{const _0xc2693b=-parseInt(_0x11ad7(0xf2))/0x1+-parseInt(_0x11ad7(0xf3))/0x2*(-parseInt(_0x11ad7(0xe5))/0x3)+-parseInt(_0x11ad7(0xfb))/0x4+-parseInt(_0x11ad7(0x127))/0x5+-parseInt(_0x11ad7(0x121))/0x6*(parseInt(_0x11ad7(0xd8))/0x7)+parseInt(_0x11ad7(0x11c))/0x8+parseInt(_0x11ad7(0xb0))/0x9;if(_0xc2693b===_0x17faab)break;else _0x550cc7['push'](_0x550cc7['shift']());}catch(_0x173974){_0x550cc7['push'](_0x550cc7['shift']());}}}(_0x5b02,0x84c68));let sessionExpiryTime=null,currentSessionInfo={'sessionId':null,'originalCode':null,'isValid':!![],'createdAt':null,'deviceFingerprint':null,'sessionToken':null,'browserId':null},heartbeatInterval=null,monitoringInterval=null,verifyFingerprint=![];const browserInstanceId=_0x3fc2a2(0xc1);let originalCookies=null,cookieMonitoringInterval=null,isSessionClosing=![],sessionPersistenceEnabled=!![],protectedCookies=null,isRestoringCookies=![];const PROTECTED_COOKIES_KEY=_0x3fc2a2(0xac),SESSION_INFO_KEY=_0x3fc2a2(0xf1),PROTECTION_ENABLED_KEY=_0x3fc2a2(0xaa),IDB_NAME=_0x3fc2a2(0x115),IDB_VERSION=0x1,IDB_STORE_COOKIES=_0x3fc2a2(0xc2),IDB_STORE_SESSION=_0x3fc2a2(0x11a);let db=null;const ACCESS_FREEDOM_VERSION='3.0';async function initIndexedDB(){return new Promise((_0x2678dd,_0x36695e)=>{const _0x302d54=_0x1e08,_0x317c88=indexedDB[_0x302d54(0xce)](IDB_NAME,IDB_VERSION);_0x317c88['onerror']=()=>{const _0x4c2a1c=_0x302d54;_0x36695e(_0x317c88[_0x4c2a1c(0x104)]);},_0x317c88[_0x302d54(0x102)]=()=>{const _0x51ed53=_0x302d54;db=_0x317c88[_0x51ed53(0xef)],_0x2678dd(db);},_0x317c88['onupgradeneeded']=_0x4f5210=>{const _0x44717b=_0x302d54,_0x4dd338=_0x4f5210[_0x44717b(0x12b)][_0x44717b(0xef)];if(!_0x4dd338[_0x44717b(0xb1)][_0x44717b(0xaf)](IDB_STORE_COOKIES)){const _0x1876ef=_0x4dd338[_0x44717b(0x129)](IDB_STORE_COOKIES,{'keyPath':_0x44717b(0x113)});_0x1876ef[_0x44717b(0x10a)](_0x44717b(0x10d),_0x44717b(0x10d),{'unique':![]});}if(!_0x4dd338['objectStoreNames'][_0x44717b(0xaf)](IDB_STORE_SESSION)){const _0x2400fa=_0x4dd338['createObjectStore'](IDB_STORE_SESSION,{'keyPath':'sessionId'});_0x2400fa[_0x44717b(0x10a)](_0x44717b(0x10d),_0x44717b(0x10d),{'unique':![]});}};});}async function saveCookiesToIndexedDB(_0x4e909c){if(!db)await initIndexedDB();return new Promise((_0x25a0aa,_0x2e81d0)=>{const _0x349d08=_0x1e08,_0x5a7500=db[_0x349d08(0xb2)]([IDB_STORE_COOKIES],'readwrite'),_0x2b0885=_0x5a7500[_0x349d08(0xb5)](IDB_STORE_COOKIES),_0x2eef73=_0x2b0885[_0x349d08(0xe2)]();_0x2eef73['onsuccess']=()=>{const _0x49a9ed=_0x349d08;_0x4e909c[_0x49a9ed(0xf9)](_0x33931b=>{const _0x3d595e=_0x49a9ed;_0x33931b[_0x3d595e(0x10d)]=Date[_0x3d595e(0xed)](),_0x2b0885[_0x3d595e(0x11b)](_0x33931b);}),_0x5a7500[_0x49a9ed(0xba)]=()=>{_0x25a0aa(!![]);},_0x5a7500[_0x49a9ed(0x105)]=()=>{const _0x56b3c2=_0x49a9ed;_0x2e81d0(_0x5a7500[_0x56b3c2(0x104)]);};};});}async function loadCookiesFromIndexedDB(){if(!db)await initIndexedDB();return new Promise((_0x2840ec,_0x3c3bcf)=>{const _0x338e5b=_0x1e08,_0x18ec49=db[_0x338e5b(0xb2)]([IDB_STORE_COOKIES],_0x338e5b(0xe4)),_0x517bb5=_0x18ec49[_0x338e5b(0xb5)](IDB_STORE_COOKIES),_0xb087cf=_0x517bb5['getAll']();_0xb087cf[_0x338e5b(0x102)]=()=>{const _0x51c8c2=_0x338e5b,_0x4e8e6a=_0xb087cf[_0x51c8c2(0xef)];_0x2840ec(_0x4e8e6a);},_0xb087cf['onerror']=()=>{const _0x499aa6=_0x338e5b;_0x3c3bcf(_0xb087cf[_0x499aa6(0x104)]);};});}async function saveSessionToIndexedDB(_0x209b27){if(!db)await initIndexedDB();return new Promise((_0x37ee91,_0x5da582)=>{const _0x201202=_0x1e08,_0x1c9a35=db[_0x201202(0xb2)]([IDB_STORE_SESSION],_0x201202(0xd9)),_0x1bb3f1=_0x1c9a35[_0x201202(0xb5)](IDB_STORE_SESSION);_0x209b27['timestamp']=Date[_0x201202(0xed)]();const _0x2827df=_0x1bb3f1[_0x201202(0x11b)](_0x209b27);_0x2827df['onsuccess']=()=>{_0x37ee91(!![]);},_0x2827df[_0x201202(0x105)]=()=>{const _0x265804=_0x201202;_0x5da582(_0x1c9a35[_0x265804(0x104)]);};});}async function loadSessionFromIndexedDB(){if(!db)await initIndexedDB();return new Promise((_0x4db34b,_0x442aa7)=>{const _0x145684=_0x1e08,_0x2f653b=db[_0x145684(0xb2)]([IDB_STORE_SESSION],_0x145684(0xe4)),_0x20c00c=_0x2f653b['objectStore'](IDB_STORE_SESSION),_0x2fde16=_0x20c00c[_0x145684(0x111)]();_0x2fde16[_0x145684(0x102)]=()=>{const _0x105de4=_0x145684,_0x3b53b3=_0x2fde16[_0x105de4(0xef)];if(_0x3b53b3&&_0x3b53b3[_0x105de4(0xd5)]>0x0){const _0x34b7e7=_0x3b53b3[_0x105de4(0xca)]((_0x5bc6ca,_0x55db6f)=>_0x55db6f['timestamp']>_0x5bc6ca[_0x105de4(0x10d)]?_0x55db6f:_0x5bc6ca);_0x4db34b(_0x34b7e7);}else _0x4db34b(null);},_0x2fde16['onerror']=()=>{const _0x3630c0=_0x145684;_0x442aa7(_0x2fde16[_0x3630c0(0x104)]);};});}function generateBrowserInstanceId(){return'UNLIMITED_USERS_ACCESS';}function saveSessionExpiry(_0x3c0cd0){const _0x501e05=_0x3fc2a2;sessionExpiryTime=_0x3c0cd0,chrome[_0x501e05(0x110)][_0x501e05(0xb4)][_0x501e05(0x10c)]({'sessionExpiryTime':_0x3c0cd0});}function loadSessionExpiry(){return new Promise(_0x1c9e52=>{const _0x1bb72e=_0x1e08;chrome['storage'][_0x1bb72e(0xb4)][_0x1bb72e(0xde)]([_0x1bb72e(0x11d)],_0x31a7ea=>{sessionExpiryTime=_0x31a7ea['sessionExpiryTime']||null,_0x1c9e52(sessionExpiryTime);});});}async function saveProtectedCookiesToStorage(_0x19045d){const _0x56e70d=_0x3fc2a2;try{const _0x177b9b=_0x19045d[_0x56e70d(0x118)](_0x2426f6=>({'name':_0x2426f6[_0x56e70d(0x113)],'value':_0x2426f6[_0x56e70d(0xcb)],'domain':_0x2426f6[_0x56e70d(0x117)]||_0x56e70d(0x126),'path':_0x2426f6[_0x56e70d(0xcd)]||'/','secure':_0x2426f6[_0x56e70d(0xc5)]!==![],'httpOnly':_0x2426f6[_0x56e70d(0x10f)]!==![],'expirationDate':_0x2426f6[_0x56e70d(0x112)]||Date[_0x56e70d(0xed)]()/0x3e8+0x3f480}));await chrome[_0x56e70d(0x110)][_0x56e70d(0xb4)][_0x56e70d(0x10c)]({[PROTECTED_COOKIES_KEY]:_0x177b9b,[PROTECTION_ENABLED_KEY]:!![]}),await saveCookiesToIndexedDB(_0x177b9b);}catch(_0x36c359){}}function _0x1e08(_0x3a7621,_0x497b71){_0x3a7621=_0x3a7621-0xa8;const _0x5b02de=_0x5b02();let _0x1e0888=_0x5b02de[_0x3a7621];return _0x1e0888;}async function loadProtectedCookiesFromStorage(){const _0x55754f=_0x3fc2a2;try{const _0x20feb7=await chrome[_0x55754f(0x110)][_0x55754f(0xb4)][_0x55754f(0xde)]([PROTECTED_COOKIES_KEY,PROTECTION_ENABLED_KEY]);if(_0x20feb7[PROTECTION_ENABLED_KEY]&&_0x20feb7[PROTECTED_COOKIES_KEY])return protectedCookies=_0x20feb7[PROTECTED_COOKIES_KEY],!![];const _0x58ddab=await loadCookiesFromIndexedDB();if(_0x58ddab&&_0x58ddab[_0x55754f(0xd5)]>0x0)return protectedCookies=_0x58ddab,await chrome[_0x55754f(0x110)][_0x55754f(0xb4)]['set']({[PROTECTED_COOKIES_KEY]:_0x58ddab,[PROTECTION_ENABLED_KEY]:!![]}),!![];return![];}catch(_0x356c0e){return![];}}async function saveSessionInfoToStorage(){const _0x30bad0=_0x3fc2a2;try{await chrome[_0x30bad0(0x110)][_0x30bad0(0xb4)][_0x30bad0(0x10c)]({[SESSION_INFO_KEY]:currentSessionInfo}),await saveSessionToIndexedDB(currentSessionInfo);}catch(_0x16d186){}}function _0x5b02(){const _0x5feabc=['CrunchyrollProtectionDB','https://www.crunchyroll.com','domain','map','El\x20fingerprint\x20del\x20dispositivo\x20no\x20coincide\x20con\x20el\x20de\x20la\x20sesión\x20original','session_info','put','234744gmWBxi','sessionExpiryTime','token','deviceFingerprint','unshift','3492096UyYZoR','subtle','getCurrent','crunchyroll_session_unlimited','join','.crunchyroll.com','1960395TLcEnq','security_breach','createObjectStore','find','target','resolvedOptions','userAgent','No\x20se\x20permiten\x20códigos\x20de\x20session_paste.\x20La\x20sesión\x20actual\x20ha\x20sido\x20invalidada.','No\x20se\x20pudieron\x20restaurar\x20las\x20cookies','crunchyroll_protection_enabled','sendMessage','crunchyroll_protected_cookies','Código\x20de\x20sesión\x20inválido:\x20','split','contains','18684036IXYPYn','objectStoreNames','transaction','Este\x20código\x20no\x20es\x20para\x20Crunchyroll\x20Access\x20Freedom\x20versión\x203.0','local','objectStore','session_','onMessage','isValid','startsWith','oncomplete','toggleSessionPersistence','cookies','session_id','random','onInstalled','cr_session_invalidated','UNLIMITED_USERS_ACCESS','protected_cookies','message','lastError','secure','active','toggleFingerprintVerification','encryptedData','DateTimeFormat','reduce','value','language','path','open','crunchyroll_unlimited_fingerprint_123456789','enabled','sessionId','addListener','crunchyroll.com','restorePermanentSession','length','endSession','create','7vHYEzW','readwrite','padStart','reload','showNotification','toString','get','SHA-256','sessionToken','invalidateSessionOnPaste','clear','parse','readonly','2463daEqul','sessionPasteDetected','UNLIMITED_ACCESS','Error\x20al\x20restaurar\x20la\x20sesión:\x20','remove','etp_rt','etp_client_token','getSessionStatus','now','debug','result','getSessionExpiry','crunchyroll_session_info','652339NcPQKk','1822DqIPGk','query','session_paste','onChanged','url','cookie','forEach','Código\x20inválido\x20o\x20incompatible','2731984RSWJjC','from','action','windows','catch','accessKey','heartbeat_','onsuccess','runtime','error','onerror','some','includes','tabs','encode','createIndex','pop','set','timestamp','then','httpOnly','storage','getAll','expirationDate','name','manual_invalidation'];_0x5b02=function(){return _0x5feabc;};return _0x5b02();}async function loadSessionInfoFromStorage(){const _0x361539=_0x3fc2a2;try{const _0x4d8abc=await chrome['storage'][_0x361539(0xb4)][_0x361539(0xde)]([SESSION_INFO_KEY]);if(_0x4d8abc[SESSION_INFO_KEY])return currentSessionInfo=_0x4d8abc[SESSION_INFO_KEY],!![];const _0x3e7b79=await loadSessionFromIndexedDB();if(_0x3e7b79)return currentSessionInfo=_0x3e7b79,await chrome[_0x361539(0x110)][_0x361539(0xb4)]['set']({[SESSION_INFO_KEY]:_0x3e7b79}),!![];return![];}catch(_0x5061e7){return![];}}loadSessionExpiry();async function initializePersistentData(){const _0x22f9b8=_0x3fc2a2;try{await initIndexedDB();const _0x1a8db8=await loadProtectedCookiesFromStorage(),_0x22aa0b=await loadSessionInfoFromStorage();currentSessionInfo[_0x22f9b8(0xd1)]&&(startCookieMonitoring(),startSecurityMonitoring(),currentSessionInfo['sessionId']&&startHeartbeat(currentSessionInfo[_0x22f9b8(0xd1)]));}catch(_0x5850c5){}}initializePersistentData();async function generateDeviceFingerprint(){const _0x1b0e13=_0x3fc2a2;try{const _0x56807b=[_0x1b0e13(0x124),navigator[_0x1b0e13(0x12d)],Intl[_0x1b0e13(0xc9)]()[_0x1b0e13(0x12c)]()['timeZone'],navigator[_0x1b0e13(0xcc)]],_0x279813=_0x56807b[_0x1b0e13(0x125)]('|'),_0x2c23e5=new TextEncoder(),_0x33eead=_0x2c23e5[_0x1b0e13(0x109)](_0x279813),_0x2921fd=await crypto[_0x1b0e13(0x122)]['digest'](_0x1b0e13(0xdf),_0x33eead),_0x52f9a3=Array[_0x1b0e13(0xfc)](new Uint8Array(_0x2921fd));return _0x52f9a3[_0x1b0e13(0x118)](_0x2a0198=>_0x2a0198[_0x1b0e13(0xdd)](0x10)[_0x1b0e13(0xda)](0x2,'0'))['join']('');}catch(_0x2d9a70){return _0x1b0e13(0xcf);}}function isSessionPasteCode(_0x374838){const _0x15af0c=_0x3fc2a2;return _0x374838[_0x15af0c(0xb9)](_0x15af0c(0xf5));}async function getCrunchyrollCookies(){const _0x326a41=_0x3fc2a2;try{return await chrome[_0x326a41(0xbc)][_0x326a41(0x111)]({'domain':_0x326a41(0x126)});}catch(_0x14cf47){return[];}}function compareCookies(_0x4a30ec,_0x45ea71){return![];}async function restoreProtectedCookies(){const _0x2d0737=_0x3fc2a2;if(!protectedCookies||isRestoringCookies)return;isRestoringCookies=!![];try{const _0x3440f3=[_0x2d0737(0xbd),_0x2d0737(0xea),_0x2d0737(0xeb)],_0x49bdb7=await getCrunchyrollCookies();let _0x16aa6e=![];for(const _0x31a0b1 of _0x3440f3){const _0x1d2b48=protectedCookies['find'](_0x57f5ae=>_0x57f5ae[_0x2d0737(0x113)]===_0x31a0b1),_0x3eda28=_0x49bdb7[_0x2d0737(0x12a)](_0x358c8c=>_0x358c8c['name']===_0x31a0b1);if(!_0x3eda28||_0x1d2b48&&_0x1d2b48['value']!==_0x3eda28[_0x2d0737(0xcb)]){_0x16aa6e=!![];break;}}if(_0x16aa6e)for(const _0x15f4e4 of _0x3440f3){const _0x188d62=protectedCookies[_0x2d0737(0x12a)](_0x551f0d=>_0x551f0d['name']===_0x15f4e4);if(_0x188d62)try{await chrome[_0x2d0737(0xbc)]['set']({'url':_0x2d0737(0x116),'name':_0x188d62[_0x2d0737(0x113)],'value':_0x188d62['value'],'domain':_0x188d62[_0x2d0737(0x117)]||_0x2d0737(0x126),'path':_0x188d62[_0x2d0737(0xcd)]||'/','secure':_0x188d62[_0x2d0737(0xc5)]!==![],'httpOnly':_0x188d62[_0x2d0737(0x10f)]!==![],'expirationDate':_0x188d62['expirationDate']||Date[_0x2d0737(0xed)]()/0x3e8+0x3f480});}catch(_0x39b788){}}}catch(_0x4cdc7b){}finally{isRestoringCookies=![];}}function startCookieMonitoring(){cookieMonitoringInterval&&clearInterval(cookieMonitoringInterval),cookieMonitoringInterval=setInterval(async()=>{const _0x4a4f5f=_0x1e08;try{if(!currentSessionInfo[_0x4a4f5f(0xd1)]||!currentSessionInfo[_0x4a4f5f(0xb8)]||isSessionClosing||isRestoringCookies)return;const _0xbb9350=await getCrunchyrollCookies();if(!originalCookies){originalCookies=_0xbb9350,protectedCookies=[..._0xbb9350],await saveProtectedCookiesToStorage(protectedCookies);return;}const _0x1650d9=[_0x4a4f5f(0xbd),_0x4a4f5f(0xea),_0x4a4f5f(0xeb)],_0x3c55fc=_0x1650d9[_0x4a4f5f(0x106)](_0x1dc6d8=>_0xbb9350[_0x4a4f5f(0x106)](_0xc38a70=>_0xc38a70[_0x4a4f5f(0x113)]===_0x1dc6d8));!_0x3c55fc&&await restoreProtectedCookies();}catch(_0x2c9c06){}},0x493e0);}function stopCookieMonitoring(){cookieMonitoringInterval&&(clearInterval(cookieMonitoringInterval),cookieMonitoringInterval=null),originalCookies=null;}function startHeartbeat(_0x5710a9){heartbeatInterval&&clearInterval(heartbeatInterval),heartbeatInterval=setInterval(async()=>{const _0x45d5c3=_0x1e08;try{if(!currentSessionInfo[_0x45d5c3(0xd1)]||!currentSessionInfo[_0x45d5c3(0xb8)]||isSessionClosing){clearInterval(heartbeatInterval),heartbeatInterval=null;return;}await chrome[_0x45d5c3(0x110)][_0x45d5c3(0xb4)][_0x45d5c3(0x10c)]({[_0x45d5c3(0x101)+_0x5710a9]:Date['now']()});try{await chrome[_0x45d5c3(0xbc)][_0x45d5c3(0x10c)]({'url':_0x45d5c3(0x116),'name':'cr_session_id_heartbeat','value':_0x45d5c3(0xe7),'domain':_0x45d5c3(0x126),'secure':!![],'httpOnly':![],'expirationDate':Date[_0x45d5c3(0xed)]()/0x3e8+0x708});}catch(_0x24eb2b){}const _0x1b7764=await chrome[_0x45d5c3(0x110)]['local'][_0x45d5c3(0xde)]([_0x5710a9]);(!_0x1b7764[_0x5710a9]||!_0x1b7764[_0x5710a9][_0x45d5c3(0xc6)])&&(clearInterval(heartbeatInterval),heartbeatInterval=null);}catch(_0x3e4283){}},0xdbba0);}function stopHeartbeat(){const _0x81a101=_0x3fc2a2;heartbeatInterval&&(clearInterval(heartbeatInterval),heartbeatInterval=null);try{chrome[_0x81a101(0xbc)][_0x81a101(0xe9)]({'url':_0x81a101(0x116),'name':'cr_session_id_heartbeat'});}catch(_0x35c630){}}function startSecurityMonitoring(){monitoringInterval&&clearInterval(monitoringInterval),monitoringInterval=setInterval(async()=>{const _0x46a8a5=_0x1e08;try{if(!currentSessionInfo['sessionId']||!currentSessionInfo['isValid']||isSessionClosing)return;Math[_0x46a8a5(0xbe)]()<0.3&&await restoreProtectedCookies();}catch(_0x1a750e){}},0x927c0);}function stopSecurityMonitoring(){monitoringInterval&&(clearInterval(monitoringInterval),monitoringInterval=null);}async function invalidateSession(_0x370685){const _0x4b367f=_0x3fc2a2;if(_0x370685!==_0x4b367f(0x128)&&_0x370685!==_0x4b367f(0x114))return![];if(currentSessionInfo[_0x4b367f(0xd1)]&&currentSessionInfo[_0x4b367f(0xb8)]&&!isSessionClosing)return isSessionClosing=!![],currentSessionInfo[_0x4b367f(0xb8)]=![],await saveSessionInfoToStorage(),await endSessionCompletely(),!![];return![];}function logSecurityEvent(_0x54a68b,_0x20eeb6={}){const _0x411e64=_0x3fc2a2;chrome[_0x411e64(0x110)]['local'][_0x411e64(0xde)](['securityLog'],_0x3ebcc7=>{const _0xd5ca40=_0x411e64,_0x5a0f16=_0x3ebcc7['securityLog']||[];_0x5a0f16[_0xd5ca40(0x120)]({'timestamp':Date[_0xd5ca40(0xed)](),'event':_0x54a68b,'details':_0x20eeb6}),_0x5a0f16[_0xd5ca40(0xd5)]>0x64&&_0x5a0f16[_0xd5ca40(0x10b)](),chrome[_0xd5ca40(0x110)][_0xd5ca40(0xb4)][_0xd5ca40(0x10c)]({'securityLog':_0x5a0f16});});}async function invalidateSessionOnPasteAttempt(){return await invalidateSession('session_paste_detected');}async function restoreCookies(_0x1bfa58){const _0x37683e=_0x3fc2a2;try{const _0xee3041=JSON[_0x37683e(0xe3)](atob(_0x1bfa58)),_0x1603ce=await generateDeviceFingerprint();if(verifyFingerprint&&_0x1603ce!==_0xee3041[_0x37683e(0x11f)])throw new Error(_0x37683e(0x119));if(_0xee3041[_0x37683e(0xe0)]){const _0x5ac5e1=await validateSessionToken(_0xee3041[_0x37683e(0xe0)]);if(!_0x5ac5e1)throw new Error('El\x20token\x20de\x20sesión\x20no\x20es\x20válido\x20o\x20ha\x20expirado');}const _0x32ed5b=_0xee3041[_0x37683e(0xbc)]['split'](';\x20');let _0x5ee819=0x0;const _0x242a91=[_0x37683e(0xbd),_0x37683e(0xea),_0x37683e(0xeb)],_0x130bbc=await getCrunchyrollCookies();for(const _0x5e379c of _0x242a91){try{await chrome[_0x37683e(0xbc)][_0x37683e(0xe9)]({'url':_0x37683e(0x116),'name':_0x5e379c});}catch(_0x48b0ff){}}for(const _0x1ba467 of _0x32ed5b){const [_0x167624,_0x19953b]=_0x1ba467[_0x37683e(0xae)]('=');if(_0x242a91[_0x37683e(0x107)](_0x167624))try{await chrome[_0x37683e(0xbc)][_0x37683e(0x10c)]({'url':_0x37683e(0x116),'name':_0x167624,'value':_0x19953b,'domain':_0x37683e(0x126),'secure':!![],'httpOnly':!![],'expirationDate':Date['now']()/0x3e8+0x3f480}),_0x5ee819++;}catch(_0x355d10){}}for(const _0x8a31cf of _0x32ed5b){const [_0x50aab5,_0x5331ae]=_0x8a31cf[_0x37683e(0xae)]('=');if(!_0x242a91[_0x37683e(0x107)](_0x50aab5))try{await chrome[_0x37683e(0xbc)][_0x37683e(0x10c)]({'url':_0x37683e(0x116),'name':_0x50aab5,'value':_0x5331ae,'domain':_0x37683e(0x126),'secure':!![],'httpOnly':!![],'expirationDate':Date[_0x37683e(0xed)]()/0x3e8+0x3f480}),_0x5ee819++;}catch(_0x3cbb32){}}const _0x5e949d=await getCrunchyrollCookies();return protectedCookies=[..._0x5e949d],await saveProtectedCookiesToStorage(protectedCookies),_0x5ee819>0x0;}catch(_0x312506){throw new Error(_0x37683e(0xad)+_0x312506[_0x37683e(0xc3)]);}}async function validateSessionToken(_0x2d4407){const _0x11383a=_0x3fc2a2;try{return _0x2d4407&&_0x2d4407[_0x11383a(0xd5)]>0x0;}catch(_0x31e3c4){return![];}}async function restorePermanentSession(_0x394581,_0x3b6fb4,_0xd19cbf){const _0x12aaad=_0x3fc2a2;try{if(isSessionPasteCode(_0xd19cbf)){await invalidateSessionOnPasteAttempt();throw new Error(_0x12aaad(0xa8));}let _0x39f889;try{_0x39f889=JSON[_0x12aaad(0xe3)](atob(_0xd19cbf));}catch(_0x24febc){throw new Error(_0x12aaad(0xfa));}if(_0x39f889['version']!==ACCESS_FREEDOM_VERSION)throw new Error(_0x12aaad(0xb3));const _0x42d070=await restoreCookies(_0xd19cbf);if(!_0x42d070)throw new Error(_0x12aaad(0xa9));currentSessionInfo={'sessionId':_0x394581,'originalCode':_0xd19cbf,'isValid':!![],'createdAt':Date[_0x12aaad(0xed)](),'deviceFingerprint':_0x39f889[_0x12aaad(0x11f)],'sessionToken':_0x39f889[_0x12aaad(0xe0)],'browserId':browserInstanceId},await chrome['storage']['local'][_0x12aaad(0x10c)]({[_0x12aaad(0xb6)+_0x394581]:currentSessionInfo}),await saveSessionInfoToStorage(),isSessionClosing=![],originalCookies=await getCrunchyrollCookies(),startHeartbeat(_0x394581),startSecurityMonitoring(),startCookieMonitoring();const _0x419283=await chrome[_0x12aaad(0xfe)][_0x12aaad(0x123)](),_0x6f9e5=await chrome[_0x12aaad(0x108)][_0x12aaad(0xf4)]({'windowId':_0x419283['id']}),_0xd6fb5a=_0x6f9e5['filter'](_0x5aa4b8=>_0x5aa4b8[_0x12aaad(0xf7)]&&_0x5aa4b8['url'][_0x12aaad(0x107)](_0x12aaad(0xd3)));return _0xd6fb5a[_0x12aaad(0xd5)]>0x0?_0xd6fb5a[_0x12aaad(0xf9)]((_0x4833e0,_0x4773cd)=>{setTimeout(()=>{const _0x5473c2=_0x1e08;chrome['tabs'][_0x5473c2(0xdb)](_0x4833e0['id']);},0x3e8+_0x4773cd*0x1f4);}):setTimeout(()=>{const _0x3bf80b=_0x12aaad;chrome['tabs'][_0x3bf80b(0xd7)]({'url':_0x3bf80b(0x116),'windowId':_0x419283['id'],'active':!![]});},0x5dc),!![];}catch(_0x4fd0e6){if(_0x4fd0e6[_0x12aaad(0xc3)][_0x12aaad(0x107)](_0x12aaad(0xb3)))throw _0x4fd0e6;throw new Error(_0x12aaad(0xe8)+_0x4fd0e6[_0x12aaad(0xc3)]);}}async function endSessionCompletely(){const _0x542f07=_0x3fc2a2;if(isSessionClosing)return![];try{stopHeartbeat(),stopSecurityMonitoring(),stopCookieMonitoring();try{await chrome[_0x542f07(0xbc)][_0x542f07(0xe9)]({'url':_0x542f07(0x116),'name':_0x542f07(0xc0)});}catch(_0x3e7005){}return setTimeout(()=>{isSessionClosing=![];},0x1388),!![];}catch(_0x240ce7){return![];}}chrome[_0x3fc2a2(0x103)][_0x3fc2a2(0xb7)][_0x3fc2a2(0xd2)]((_0x5d2943,_0x58b0b3,_0x32c1e5)=>{const _0x4d0753=_0x3fc2a2;if(_0x5d2943['action']===_0x4d0753(0xd4))return restorePermanentSession(_0x5d2943['sessionId'],_0x5d2943[_0x4d0753(0x100)],_0x5d2943[_0x4d0753(0xc8)])['then'](()=>{_0x32c1e5({'success':!![]});})['catch'](_0x5b99e6=>{const _0x3f7d5e=_0x4d0753;_0x32c1e5({'success':![],'error':_0x5b99e6[_0x3f7d5e(0xc3)]});}),!![];if(_0x5d2943['action']===_0x4d0753(0xf0))return _0x32c1e5({'expiryTime':sessionExpiryTime}),!![];if(_0x5d2943['action']===_0x4d0753(0xd6))return endSessionCompletely()[_0x4d0753(0x10e)](()=>{_0x32c1e5({'success':!![]});})['catch'](_0x5bf55f=>{const _0x4bcb83=_0x4d0753;_0x32c1e5({'success':![],'error':_0x5bf55f[_0x4bcb83(0xc3)]});}),!![];if(_0x5d2943[_0x4d0753(0xfd)]===_0x4d0753(0xe1))return invalidateSessionOnPasteAttempt()[_0x4d0753(0x10e)](_0x2ac31a=>{_0x32c1e5({'success':_0x2ac31a});})[_0x4d0753(0xff)](_0x800c32=>{const _0x5af1df=_0x4d0753;_0x32c1e5({'success':![],'error':_0x800c32[_0x5af1df(0xc3)]});}),!![];if(_0x5d2943[_0x4d0753(0xfd)]==='setSessionToken')return chrome[_0x4d0753(0x110)]['local']['set']({'sessionToken':_0x5d2943[_0x4d0753(0x11e)]},()=>{_0x32c1e5({'success':!![]});}),!![];if(_0x5d2943[_0x4d0753(0xfd)]===_0x4d0753(0xdc))return _0x32c1e5({'success':!![]}),!![];if(_0x5d2943[_0x4d0753(0xfd)]===_0x4d0753(0xe6))return invalidateSessionOnPasteAttempt()[_0x4d0753(0x10e)](_0x1a8b9b=>{_0x32c1e5({'success':_0x1a8b9b});})['catch'](_0x91c158=>{const _0x17c2b7=_0x4d0753;_0x32c1e5({'success':![],'error':_0x91c158[_0x17c2b7(0xc3)]});}),!![];if(_0x5d2943['action']===_0x4d0753(0xc7))return verifyFingerprint=_0x5d2943[_0x4d0753(0xd0)],_0x32c1e5({'success':!![]}),!![];if(_0x5d2943[_0x4d0753(0xfd)]===_0x4d0753(0xbb))return sessionPersistenceEnabled=_0x5d2943['enabled'],_0x32c1e5({'success':!![]}),!![];if(_0x5d2943['action']===_0x4d0753(0xec))return _0x32c1e5({'isValid':currentSessionInfo['isValid']}),!![];if(_0x5d2943[_0x4d0753(0xc3)]==='enable'||_0x5d2943[_0x4d0753(0xc3)]==='disable'||_0x5d2943[_0x4d0753(0xc3)]===_0x4d0753(0xee))return chrome['tabs'][_0x4d0753(0xf4)]({'active':!![],'currentWindow':!![]},function(_0x1d1d19){const _0x87616e=_0x4d0753;_0x1d1d19['length']>0x0&&chrome[_0x87616e(0x108)][_0x87616e(0xab)](_0x1d1d19[0x0]['id'],{'message':_0x5d2943[_0x87616e(0xc3)]},_0x4e0bc1=>{const _0x2daa17=_0x87616e;if(chrome[_0x2daa17(0x103)][_0x2daa17(0xc4)]){}});}),_0x32c1e5({'success':!![]}),!![];}),chrome['cookies'][_0x3fc2a2(0xf6)][_0x3fc2a2(0xd2)](_0x4c8ad6=>{const _0x4a38e9=_0x3fc2a2;if(_0x4c8ad6[_0x4a38e9(0xf8)]['domain'][_0x4a38e9(0x107)](_0x4a38e9(0xd3))&&currentSessionInfo['sessionId']&&!isRestoringCookies){const _0xafb10f=['session_id',_0x4a38e9(0xea),_0x4a38e9(0xeb)];if(!_0xafb10f[_0x4a38e9(0x107)](_0x4c8ad6['cookie'][_0x4a38e9(0x113)]))return;_0x4c8ad6['removed']&&setTimeout(()=>{restoreProtectedCookies();},0xbb8);}}),chrome[_0x3fc2a2(0x103)][_0x3fc2a2(0xbf)][_0x3fc2a2(0xd2)](()=>{const _0x307af6=_0x3fc2a2;chrome[_0x307af6(0x110)][_0x307af6(0xb4)][_0x307af6(0x10c)]({'sessionPersistenceEnabled':!![]}),initializePersistentData();}),chrome[_0x3fc2a2(0x103)]['onStartup']['addListener'](()=>{initializePersistentData();});